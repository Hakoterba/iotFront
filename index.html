<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capture de drapeaux</title>
  <style>
    #canvasContainer {
      width: 1200px;
      height: 500px;
      position: relative;
    }

    canvas {
      position: absolute;
      border: 1px solid black;
      background: transparent;
    }

    #canvas1 {
      left: 0;
    }

    #canvas2 {
      left: 900px;
    }
  </style>
</head>

<body>
  <div id="app">
    <h1>Capture de drapeaux</h1>

    <div id="canvasContainer">
      <canvas id="canvas1" width="900" height="500"></canvas>
      <canvas id="canvas2" width="300" height="500"></canvas>
    </div>
  </div>

  <script>
    const canvas1 = document.getElementById('canvas1');
    const ctx1 = canvas1.getContext('2d');
    const canvas2 = document.getElementById('canvas2');
    const ctx2 = canvas2.getContext('2d');

    let offsetX, offsetY, dragging = false, draggedImage = null;
    let imagePositions = []; 

    const flagsData = [
      {"id":"567d5781-e49a-4ba1-867c-b53632fe2b7f","socket":"E1DSjMDuE6AXjMRWAAAQ","color":"red"},
      {"id":"098d62b8-c68e-4cce-821a-cae81bde0a90","socket":"yBmcFQXN6XMqHaZuAAAS","color":"white"}
    ];

    // Charger l'image du 
    const flagImg = new Image();
    flagImg.src = './src/assets/flag.png'; // Remplace par ton fichier flag.png

    flagImg.onload = () => {
      let xPos = 50; // Position initiale des drapeaux

      flagsData.forEach((flagData) => {
        imagePositions.push({
          image: flagImg,
          x: xPos,
          y: 50, // Position initiale verticale
          canvas: 'canvas2' // Début sur le deuxième canvas
        });

        xPos += 90; // Espacement entre les drapeaux
      });

      drawImages(); // Dessiner les drapeaux dès que l'image est prête
    };

    // Fonction pour dessiner les drapeaux
    function drawImages() {
      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
      ctx2.clearRect(0, 0, canvas2.width, canvas2.height);

      imagePositions.forEach((imageObj) => {
        if (imageObj.canvas === 'canvas1') {
          ctx1.drawImage(imageObj.image, imageObj.x, imageObj.y, 150, 150);
        } else {
          ctx2.drawImage(imageObj.image, imageObj.x, imageObj.y, 150, 150);
        }
      });
    }

    // Vérifier si on clique sur un drapeau
    function checkCanvas(mouseX, mouseY) {
      return imagePositions.find((imageObj) => {
        return mouseX >= imageObj.x && mouseX <= imageObj.x + 150 &&
               mouseY >= imageObj.y && mouseY <= imageObj.y + 150;
      });
    }

    // Début du drag
    function startDrag(e, canvas) {
      const mouseX = e.offsetX;
      const mouseY = e.offsetY;

      draggedImage = checkCanvas(mouseX, mouseY);
      if (draggedImage) {
        dragging = true;
        offsetX = mouseX - draggedImage.x;
        offsetY = mouseY - draggedImage.y;
      }
    }

    // Déplacement de l'image
    function dragImage(e, ctx) {
      if (dragging) {
        const mouseX = e.offsetX;
        const mouseY = e.offsetY;
        draggedImage.x = mouseX - offsetX;
        draggedImage.y = mouseY - offsetY;
        drawImages();
      }
    }

    // Fin du drag
    function stopDrag() {
      dragging = false;
      draggedImage = null;
      drawImages();
    }

    // Permettre de déplacer entre les canvases
    function transferImage(canvasTarget) {
      if (draggedImage) {
        draggedImage.canvas = canvasTarget;
        drawImages();
      }
    }

    // Événements pour le canvas2
    canvas2.addEventListener('mousedown', (e) => startDrag(e, canvas2));
    canvas2.addEventListener('mousemove', (e) => dragImage(e, ctx2));
    canvas2.addEventListener('mouseup', stopDrag);
    canvas2.addEventListener('mouseleave', () => transferImage('canvas1'));

    // Événements pour le canvas1
    canvas1.addEventListener('mousedown', (e) => startDrag(e, canvas1));
    canvas1.addEventListener('mousemove', (e) => dragImage(e, ctx1));
    canvas1.addEventListener('mouseup', stopDrag);
    canvas1.addEventListener('mouseleave', () => transferImage('canvas2'));
  </script>
</body>

</html>
